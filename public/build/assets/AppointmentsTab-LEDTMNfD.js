import{r,a as f,j as e}from"./app-_siWTVfm.js";import{X as A}from"./index.es-Bgw6mkd5.js";import{z as n}from"./index-fhGExnhK.js";function M({show:c,onClose:v,patientId:y,appointment:i=null}){const[s,p]=r.useState({patient_id:y,user_id:"",fecha_inicio:"",fecha_fin:"",tipo:"presencial",state:"Creado",motivo:"",observaciones:""}),[j,N]=r.useState([]),[m,d]=r.useState(!1),[E,b]=r.useState(!1),[g,w]=r.useState("");r.useEffect(()=>{c&&(C(),i&&p({patient_id:y,user_id:i.user_id,fecha_inicio:i.fecha_inicio.substring(0,16),fecha_fin:i.fecha_fin.substring(0,16),tipo:i.tipo,state:i.state,motivo:i.motivo||"",observaciones:i.observaciones||""}))},[c,i,y]);const C=async()=>{try{const t=await f.get("/admin/api/psicologos/disponibles");N(t.data.data||[])}catch(t){console.error("Error al cargar psicólogos:",t),n.error("Error al cargar psicólogos")}},_=async()=>{if(!(!s.user_id||!s.fecha_inicio)){b(!0),w("");try{const t=s.fecha_inicio.split("T")[0];(await f.get(`/admin/api/psicologos/${s.user_id}/disponibilidad`,{params:{date:t}})).data.available?w("✓ El psicólogo está disponible en esta fecha"):w("⚠ El psicólogo podría no estar disponible. Verifica su horario.")}catch(t){console.error("Error al verificar disponibilidad:",t)}finally{b(!1)}}};r.useEffect(()=>{if(s.user_id&&s.fecha_inicio){const t=setTimeout(()=>{_()},500);return()=>clearTimeout(t)}},[s.user_id,s.fecha_inicio]);const l=t=>{const{name:x,value:a}=t.target;if(p(o=>({...o,[x]:a})),x==="fecha_inicio"&&a){const o=new Date(a),u=new Date(o.getTime()+50*6e4).toISOString().substring(0,16);p(S=>({...S,fecha_fin:u}))}},k=async t=>{var o,h;if(t.preventDefault(),!s.user_id){n.error("Selecciona un psicólogo");return}if(!s.fecha_inicio||!s.fecha_fin){n.error("Completa las fechas de inicio y fin");return}const x=new Date(s.fecha_inicio);if(new Date(s.fecha_fin)<=x){n.error("La fecha de fin debe ser posterior a la fecha de inicio");return}d(!0);try{i?(await f.put(`/admin/api/citas/${i.id}`,s),n.success("Cita actualizada exitosamente")):(await f.post("/admin/api/citas",s),n.success("Cita creada exitosamente")),v(!0)}catch(u){console.error("Error al guardar cita:",u),n.error(((h=(o=u.response)==null?void 0:o.data)==null?void 0:h.message)||"Error al guardar la cita")}finally{d(!1)}};return c?e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:i?"Editar Cita":"Nueva Cita"}),e.jsx("button",{onClick:()=>v(!1),className:"text-gray-400 hover:text-gray-500",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Psicólogo *"}),e.jsxs("select",{name:"user_id",value:s.user_id,onChange:l,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar psicólogo"}),j.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Fecha y Hora de Inicio *"}),e.jsx("input",{type:"datetime-local",name:"fecha_inicio",value:s.fecha_inicio,onChange:l,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Fecha y Hora de Fin *"}),e.jsx("input",{type:"datetime-local",name:"fecha_fin",value:s.fecha_fin,onChange:l,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0})]}),g&&e.jsx("div",{className:`text-sm p-2 rounded ${g.startsWith("✓")?"bg-green-50 text-green-700":"bg-yellow-50 text-yellow-700"}`,children:g}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tipo de Cita *"}),e.jsxs("select",{name:"tipo",value:s.tipo,onChange:l,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:!0,children:[e.jsx("option",{value:"presencial",children:"Presencial"}),e.jsx("option",{value:"virtual",children:"Virtual"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Estado"}),e.jsxs("select",{name:"state",value:s.state,onChange:l,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",children:[e.jsx("option",{value:"Creado",children:"Creado"}),e.jsx("option",{value:"Confirmado",children:"Confirmado"}),e.jsx("option",{value:"Completado",children:"Completado"}),e.jsx("option",{value:"Cancelado",children:"Cancelado"}),e.jsx("option",{value:"No asistió",children:"No asistió"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Motivo de la Cita"}),e.jsx("input",{type:"text",name:"motivo",value:s.motivo,onChange:l,placeholder:"Ej: Sesión de seguimiento",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Observaciones"}),e.jsx("textarea",{name:"observaciones",value:s.observaciones,onChange:l,rows:"3",placeholder:"Notas adicionales sobre la cita",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",disabled:m,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50",disabled:m,children:m?"Guardando...":i?"Actualizar":"Crear Cita"})]})]})]})}):null}function L({patientId:c}){const[v,y]=r.useState([]),[i,s]=r.useState(!0),[p,j]=r.useState(!1),[N,m]=r.useState(null),[d,E]=r.useState(null),b=async()=>{try{s(!0);const a=await f.get(`/admin/api/pacientes/${c}/citas`);y(a.data.data||[])}catch(a){console.error("Error al cargar citas:",a),n.error("Error al cargar las citas")}finally{s(!1)}},g=async()=>{try{const a=await f.get(`/admin/api/pacientes/${c}/citas/stats`);E(a.data)}catch(a){console.error("Error al cargar estadísticas:",a)}};r.useEffect(()=>{b(),g()},[c]);const w=()=>{m(null),j(!0)},C=a=>{m(a),j(!0)},_=async a=>{var o,h;if(confirm("¿Estás seguro de que deseas cancelar esta cita?"))try{await f.delete(`/admin/api/citas/${a}`),n.success("Cita cancelada exitosamente"),b(),g()}catch(u){console.error("Error al cancelar cita:",u),n.error(((h=(o=u.response)==null?void 0:o.data)==null?void 0:h.message)||"Error al cancelar la cita")}},l=(a=!1)=>{j(!1),m(null),a&&(b(),g())},k=a=>({Creado:"bg-blue-100 text-blue-800",programada:"bg-blue-100 text-blue-800",Confirmado:"bg-green-100 text-green-800",confirmada:"bg-green-100 text-green-800",Completado:"bg-gray-100 text-gray-800",completada:"bg-gray-100 text-gray-800",Cancelado:"bg-red-100 text-red-800",cancelada:"bg-red-100 text-red-800","No asistió":"bg-yellow-100 text-yellow-800",no_asistio:"bg-yellow-100 text-yellow-800"})[a]||"bg-gray-100 text-gray-800",t=a=>a==="presencial"?"bg-purple-100 text-purple-800":"bg-cyan-100 text-cyan-800",x=[{name:"Fecha",selector:a=>a.fecha_inicio,sortable:!0,format:a=>new Date(a.fecha_inicio).toLocaleString("es-MX",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),width:"180px"},{name:"Psicólogo",selector:a=>{var o;return((o=a.user)==null?void 0:o.name)||"N/A"},sortable:!0},{name:"Tipo",cell:a=>e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t(a.tipo)}`,children:a.tipo==="presencial"?"Presencial":"Virtual"}),width:"120px"},{name:"Estado",cell:a=>e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${k(a.state)}`,children:a.state==="programada"?"Programada":a.state==="confirmada"?"Confirmada":a.state==="completada"?"Completada":a.state==="cancelada"?"Cancelada":a.state==="no_asistio"?"No Asistió":a.state}),width:"130px"},{name:"Duración",selector:a=>{const o=new Date(a.fecha_inicio);return`${(new Date(a.fecha_fin)-o)/(1e3*60)} min`},width:"100px"},{name:"Acciones",cell:a=>e.jsx("div",{className:"flex space-x-2",children:!["cancelada","Cancelado","completada","Completado"].includes(a.state)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>C(a),className:"text-indigo-600 hover:text-indigo-900",title:"Editar",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})}),e.jsx("button",{onClick:()=>_(a.id),className:"text-red-600 hover:text-red-900",title:"Cancelar",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})}),width:"100px"}];return e.jsxs("div",{children:[d&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total de Citas"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:d.total})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Completadas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d.completadas})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:d.pendientes})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Canceladas"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:d.canceladas})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:w,className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded",children:"+ Nueva Cita"})}),e.jsx(A,{columns:x,data:v,progressPending:i,pagination:!0,paginationPerPage:10,paginationRowsPerPageOptions:[10,20,30,50],noDataComponent:"No hay citas registradas",highlightOnHover:!0,pointerOnHover:!0}),p&&e.jsx(M,{show:p,onClose:l,patientId:c,appointment:N})]})}export{L as default};
