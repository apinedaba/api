import{r as n,a as M,j as e,S as W,A as D}from"./app-L7BGSx6H.js";import{A as I}from"./AuthenticatedLayout-aWLMPsOJ.js";import{X as R}from"./index.es-D5r8P9MJ.js";import{M as H,S as T}from"./SecondaryButton-BtyOCTHO.js";import{I as L}from"./InputLabel-Bk5udPoe.js";import{T as w}from"./TextInput-hKE9Pis7.js";import{I as _}from"./InputError-Cp_TqxR-.js";import{P as B}from"./PrimaryButton-CQiQArrH.js";import{n as u,F as q}from"./index-m02iQh4F.js";import"./ApplicationLogo-xG5MM7nW.js";import"./transition-DkF1EFO_.js";function O({show:t,onClose:r,onSuccess:j}){const[l,P]=n.useState(!1),[k,E]=n.useState([]),[c,v]=n.useState({name:"",email:"",telefono:"",password:"",psychologist_id:"",activo:!0}),[g,f]=n.useState({});n.useEffect(()=>{t&&A()},[t]);const A=async()=>{try{const i=await M.get("/admin/api/psicologos/disponibles");i.data.success&&E(i.data.data)}catch(i){console.error("Error fetching psychologists:",i),u.error("Error al cargar psicólogos")}},x=i=>{const{name:y,value:d,type:N,checked:C}=i.target;v(m=>({...m,[y]:N==="checkbox"?C:d})),g[y]&&f(m=>({...m,[y]:null}))},S=async i=>{var y,d,N,C;i.preventDefault(),P(!0),f({});try{const m={name:c.name,email:c.email,contacto:{telefono:c.telefono},password:c.password||c.telefono,activo:c.activo};c.psychologist_id&&(m.psychologist_id=c.psychologist_id);const p=await M.post("/admin/api/pacientes",m);p.data.success&&(u.success(p.data.message||"Paciente creado exitosamente"),j&&j(),b())}catch(m){console.error("Error creating patient:",m),(d=(y=m.response)==null?void 0:y.data)!=null&&d.errors?f(m.response.data.errors):(C=(N=m.response)==null?void 0:N.data)!=null&&C.message?u.error(m.response.data.message):u.error("Error al crear el paciente")}finally{P(!1)}},b=()=>{v({name:"",email:"",telefono:"",password:"",psychologist_id:"",activo:!0}),f({}),r()};return e.jsx(H,{show:t,onClose:b,maxWidth:"2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Agregar Nuevo Paciente"}),e.jsx("button",{onClick:b,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(L,{htmlFor:"name",value:"Nombre Completo *"}),e.jsx(w,{id:"name",name:"name",value:c.name,onChange:x,className:"mt-1 block w-full",placeholder:"Ej: Juan Pérez",required:!0}),g.name&&e.jsx(_,{message:g.name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"email",value:"Correo Electrónico *"}),e.jsx(w,{id:"email",name:"email",type:"email",value:c.email,onChange:x,className:"mt-1 block w-full",placeholder:"ejemplo@correo.com",required:!0}),g.email&&e.jsx(_,{message:g.email,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"telefono",value:"Teléfono (10 dígitos) *"}),e.jsx(w,{id:"telefono",name:"telefono",type:"tel",value:c.telefono,onChange:x,className:"mt-1 block w-full",placeholder:"1234567890",maxLength:"10",required:!0}),g["contacto.telefono"]&&e.jsx(_,{message:g["contacto.telefono"],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"password",value:"Contraseña (opcional)"}),e.jsx(w,{id:"password",name:"password",type:"password",value:c.password,onChange:x,className:"mt-1 block w-full",placeholder:"Si está vacío, se usará el teléfono"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Si no se proporciona, se usará el número de teléfono como contraseña"}),g.password&&e.jsx(_,{message:g.password,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(L,{htmlFor:"psychologist_id",value:"Asignar a Psicólogo (opcional)"}),e.jsxs("select",{id:"psychologist_id",name:"psychologist_id",value:c.psychologist_id,onChange:x,className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",children:[e.jsx("option",{value:"",children:"-- Seleccionar psicólogo --"}),k.map(i=>e.jsxs("option",{value:i.id,children:[i.name," - ",i.email]},i.id))]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Puedes asignar un psicólogo ahora o hacerlo más tarde"}),g.psychologist_id&&e.jsx(_,{message:g.psychologist_id,className:"mt-2"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"activo",name:"activo",type:"checkbox",checked:c.activo,onChange:x,className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"activo",className:"ml-2 block text-sm text-gray-900",children:"Paciente activo"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t",children:[e.jsx(T,{type:"button",onClick:b,children:"Cancelar"}),e.jsx(B,{type:"submit",disabled:l,children:l?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creando..."]}):"Crear Paciente"})]})]})]})})}function V({show:t,patient:r,onClose:j,onSuccess:l}){const[P,k]=n.useState(!1),[E,c]=n.useState([]),[v,g]=n.useState(""),[f,A]=n.useState(!1),[x,S]=n.useState([]),[b,i]=n.useState("");n.useEffect(()=>{t&&r&&(y(),S(r.connections||[]))},[t,r]);const y=async()=>{try{const a=await M.get("/admin/api/psicologos/disponibles");a.data.success&&c(a.data.data)}catch(a){console.error("Error fetching psychologists:",a),u.error("Error al cargar psicólogos")}},d=async a=>{var s,o;if(a.preventDefault(),!v){i("Debes seleccionar un psicólogo");return}k(!0),i("");try{const h=await M.post(`/admin/api/pacientes/${r.id}/asignar-psicologo`,{psychologist_id:v,set_as_active:f});h.data.success&&(u.success(h.data.message||"Psicólogo asignado exitosamente"),l&&l(),m())}catch(h){console.error("Error assigning psychologist:",h),(o=(s=h.response)==null?void 0:s.data)!=null&&o.message?u.error(h.response.data.message):u.error("Error al asignar el psicólogo")}finally{k(!1)}},N=async a=>{if(confirm("¿Estás seguro de que quieres remover este psicólogo del paciente?"))try{(await M.delete(`/admin/api/pacientes/${r.id}/psicologos/${a}`)).data.success&&(u.success("Psicólogo removido exitosamente"),S(o=>o.filter(h=>h.user.id!==a)),l&&l())}catch(s){console.error("Error removing psychologist:",s),u.error("Error al remover el psicólogo")}},C=async a=>{try{(await M.put(`/admin/api/pacientes/${r.id}/psicologos/${a}/activar`)).data.success&&(u.success("Psicólogo principal actualizado"),S(o=>o.map(h=>({...h,activo:h.user.id===a}))),l&&l())}catch(s){console.error("Error setting active psychologist:",s),u.error("Error al establecer el psicólogo principal")}},m=()=>{g(""),A(!1),i(""),j()},p=()=>{const a=x.map(s=>{var o;return(o=s.user)==null?void 0:o.id});return E.filter(s=>!a.includes(s.id))};return e.jsx(H,{show:t,onClose:m,maxWidth:"3xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Gestionar Psicólogos"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Paciente: ",e.jsx("span",{className:"font-semibold",children:r==null?void 0:r.name})]})]}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:["Psicólogos Asignados (",x.length,")"]}),x.length===0?e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 text-center text-gray-500",children:"No hay psicólogos asignados a este paciente"}):e.jsx("div",{className:"space-y-2",children:x.map(a=>{var s,o,h,F;return e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg border ${a.activo?"border-green-300 bg-green-50":"border-gray-200 bg-white"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-semibold",children:(o=(s=a.user)==null?void 0:s.name)==null?void 0:o.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:[(h=a.user)==null?void 0:h.name,a.activo&&e.jsx("span",{className:"ml-2 px-2 py-1 text-xs bg-green-600 text-white rounded-full",children:"Principal"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:(F=a.user)==null?void 0:F.email}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Estado: ",a.status]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[!a.activo&&e.jsx("button",{onClick:()=>C(a.user.id),className:"px-3 py-1 text-sm bg-green-500 text-white rounded hover:bg-green-600",title:"Establecer como principal",children:"Activar"}),e.jsx("button",{onClick:()=>N(a.user.id),className:"px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600",title:"Remover psicólogo",children:"Remover"})]})]},a.id)})})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Asignar Nuevo Psicólogo"}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(L,{htmlFor:"psychologist_select",value:"Seleccionar Psicólogo"}),e.jsxs("select",{id:"psychologist_select",value:v,onChange:a=>{g(a.target.value),i("")},className:"mt-1 block w-full border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",children:[e.jsx("option",{value:"",children:"-- Seleccionar psicólogo --"}),p().map(a=>e.jsxs("option",{value:a.id,children:[a.name," - ",a.email,a.especialidad&&` (${a.especialidad})`]},a.id))]}),b&&e.jsx(_,{message:b,className:"mt-2"}),p().length===0&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Todos los psicólogos disponibles ya están asignados"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"set_as_active",type:"checkbox",checked:f,onChange:a=>A(a.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"set_as_active",className:"ml-2 block text-sm text-gray-900",children:"Establecer como psicólogo principal"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(T,{type:"button",onClick:m,children:"Cerrar"}),e.jsx(B,{type:"submit",disabled:P||!v||p().length===0,children:P?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Asignando..."]}):"Asignar Psicólogo"})]})]})]})]})]})})}function oe({auth:t,pacientes:r,status:j}){const[l,P]=n.useState(r||[]),[k,E]=n.useState(!1),[c,v]=n.useState(!1),[g,f]=n.useState(null),[A,x]=n.useState(!1),S=()=>{E(!0)},b=s=>{f(s),v(!0)},i=()=>{x(!0),D.reload({only:["pacientes"],onFinish:()=>{x(!1),u.success("Lista actualizada")}})},y=[{name:"ID",selector:s=>s==null?void 0:s.id,cell:s=>e.jsx("a",{href:`/paciente/${s==null?void 0:s.id}`,className:"text-blue-600 hover:underline",children:s==null?void 0:s.id}),width:"80px"},{name:"Nombre",selector:s=>s==null?void 0:s.name,cell:s=>{var o;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center text-sm font-semibold",children:(o=s==null?void 0:s.name)==null?void 0:o.charAt(0).toUpperCase()}),e.jsx("span",{children:s==null?void 0:s.name})]})},sortable:!0,grow:2},{name:"Email",selector:s=>s==null?void 0:s.email,cell:s=>s==null?void 0:s.email,sortable:!0},{name:"Teléfono",selector:s=>$(s),cell:s=>$(s)},{name:"Psicólogos",selector:s=>{var o;return((o=s==null?void 0:s.connections)==null?void 0:o.length)||0},cell:s=>{var F;const o=(s==null?void 0:s.connections)||[],h=o.find(z=>z.activo);return e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"font-semibold",children:[o.length," asignado(s)"]}),h&&e.jsxs("span",{className:"text-xs text-green-600",children:["Principal: ",(F=h.user)==null?void 0:F.name]})]})},width:"180px"},{name:"Estado",selector:s=>s==null?void 0:s.activo,cell:s=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${s!=null&&s.activo?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s!=null&&s.activo?"Activo":"Inactivo"}),width:"100px"},{name:"Acciones",cell:s=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(s),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm",title:"Asignar psicólogo",children:"Asignar"}),e.jsx("a",{href:`/paciente/${s==null?void 0:s.id}`,className:"px-3 py-1 bg-gray-500 text-white rounded hover:bg-gray-600 text-sm",children:"Ver"})]}),width:"150px"}],[d,N]=n.useState(!1),[C,m]=n.useState(!1),p=d!=null&&d.name?r==null?void 0:r.filter(s=>{var o;return s.name&&s.name.toLowerCase().includes((o=d==null?void 0:d.name)==null?void 0:o.toLowerCase())}):r,a=n.useMemo(()=>{const s=()=>{d&&(m(!C),N({}))};return e.jsx(X,{onFilter:N,onClear:s,filters:d})},[d,C]);return e.jsxs(I,{user:t.user,header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Pacientes"}),e.jsxs("button",{onClick:S,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Agregar Paciente"]})]}),children:[e.jsx(W,{title:"Pacientes"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Lista de pacientes (",(l==null?void 0:l.length)||0,")"]}),e.jsxs("button",{onClick:i,disabled:A,className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-900 flex items-center gap-1",children:[e.jsx("svg",{className:`w-4 h-4 ${A?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Actualizar"]})]}),e.jsx(R,{columns:y,data:d!=null&&d.onlyActives?p==null?void 0:p.filter(s=>s==null?void 0:s.activo):p,pagination:!0,paginationPerPage:15,paginationRowsPerPageOptions:[10,15,25,50],subHeader:!0,subHeaderComponent:a,persistTableHead:!0,highlightOnHover:!0,pointerOnHover:!0})]})})})}),e.jsx(q,{position:"top-right"}),k&&e.jsx(O,{show:k,onClose:()=>E(!1),onSuccess:i}),c&&g&&e.jsx(V,{show:c,patient:g,onClose:()=>{v(!1),f(null)},onSuccess:i})]})}const X=({filter:t,onFilter:r,onClear:j})=>e.jsxs("div",{className:"grid grid-cols-2 w-full gap-4",children:[e.jsx("div",{className:"flex justify-start items-center",children:e.jsxs("label",{htmlFor:"onLyActives",className:`flex items-center gap-2 cursor-pointer border border-gray-300 rounded-md p-2 ${t!=null&&t.onlyActives?"bg-gray-100":""}`,children:["Ver Solo Activos",e.jsx("input",{type:"checkbox",name:"OnlyActives",className:"hidden",id:"onLyActives",onChange:()=>r(l=>({...l,onlyActives:!(l!=null&&l.onlyActives)})),checked:t==null?void 0:t.onlyActives})]})}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("input",{id:"search",type:"text",placeholder:"Buscar por nombre","aria-label":"Search Input",value:t==null?void 0:t.name,onChange:l=>r(P=>({...P,name:l.target.value})),className:"border border-gray-300 rounded-md p-2"}),e.jsx("button",{type:"button",onClick:j,className:"bg-red-500 text-white px-2 py-2 absolute top-0 right-0 h-full rounded-r-md",children:"X"})]})]});function $(t){var j,l;const r=(j=t==null?void 0:t.contacto)==null?void 0:j.telefono;return typeof(t==null?void 0:t.contacto)=="object"&&(t!=null&&t.contacto)?r:(l=JSON.parse(t==null?void 0:t.contacto))==null?void 0:l.telefono}export{oe as default};
